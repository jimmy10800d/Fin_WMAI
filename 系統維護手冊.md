# Fin_WMAI 系統維護手冊

<div align="center">
  <h3>🔧 系統管理員與維護人員指南</h3>
  <p>本手冊提供系統日常維護、監控與管理的完整指引</p>
</div>

---

## 📖 目錄

1. [系統架構概述](#1-系統架構概述)
2. [環境需求與部署](#2-環境需求與部署)
3. [服務啟動與停止](#3-服務啟動與停止)
4. [後台管理系統](#4-後台管理系統)
5. [AI 服務管理](#5-ai-服務管理)
6. [日常維護任務](#6-日常維護任務)
7. [監控與告警](#7-監控與告警)
8. [備份與還原](#8-備份與還原)
9. [故障排除](#9-故障排除)
10. [安全管理](#10-安全管理)

---

## 1. 系統架構概述

### 1.1 系統組件

```
┌────────────────────────────────────────────────────────┐
│                     Fin_WMAI 系統架構                    │
├────────────────────────────────────────────────────────┤
│                                                         │
│  ┌─────────────┐    ┌─────────────┐    ┌─────────────┐ │
│  │   前台應用   │    │   後台管理   │    │  AI 服務    │ │
│  │  (index.html)│    │(admin/index)│    │  (Ollama)   │ │
│  └──────┬──────┘    └──────┬──────┘    └──────┬──────┘ │
│         │                  │                  │         │
│         └──────────────────┼──────────────────┘         │
│                            │                            │
│                   ┌────────▼────────┐                   │
│                   │  HTTP Server    │                   │
│                   │   (Port 8000)   │                   │
│                   └────────┬────────┘                   │
│                            │                            │
│                   ┌────────▼────────┐                   │
│                   │   資料層         │                   │
│                   │ (demo-data.json)│                   │
│                   └─────────────────┘                   │
└────────────────────────────────────────────────────────┘
```

### 1.2 技術棧

| 組件 | 技術 | 版本 |
|------|------|------|
| 前端 | HTML5/CSS3/JavaScript | - |
| 伺服器 | Python HTTP Server | 3.x |
| AI 服務 | Ollama | Latest |
| AI 模型 | llama3.1:8b | 8B 參數 |

### 1.3 目錄結構

```
Fin_WMAI/
├── prototype/
│   ├── index.html          # 前台主頁
│   ├── login.html          # 前台登入
│   ├── css/                # 樣式檔案
│   ├── js/                 # JavaScript
│   ├── data/               # 資料檔案
│   │   └── demo-data.json  # Demo 資料
│   ├── IP_ICON/            # 圖示資源
│   └── admin/              # 後台系統
│       ├── index.html
│       ├── login.html
│       ├── css/
│       └── js/
├── DOC/                    # 文件資料
└── *.md                    # 說明文件
```

---

## 2. 環境需求與部署

### 2.1 硬體需求

| 項目 | 最低需求 | 建議配置 |
|------|---------|---------|
| CPU | 2 核心 | 4 核心以上 |
| 記憶體 | 4GB | 8GB（含 AI）/ 16GB（大模型）|
| 硬碟 | 10GB | 50GB（含模型）|
| 網路 | 100Mbps | 1Gbps |

### 2.2 軟體需求

```bash
# 必要軟體
- Python 3.8+
- 現代瀏覽器（Chrome/Firefox/Edge）

# 選用軟體（AI 功能）
- Ollama
- llama3.1:8b 模型
```

### 2.3 安裝步驟

#### 步驟一：安裝 Python

```bash
# Windows - 下載並安裝 Python
# https://www.python.org/downloads/

# 驗證安裝
python --version
```

#### 步驟二：安裝 Ollama（可選）

```bash
# Windows - 下載 Ollama 安裝程式
# https://ollama.ai/download

# 驗證安裝
ollama --version

# 下載模型
ollama pull llama3.1:8b
```

#### 步驟三：部署程式碼

```bash
# 複製程式碼至目標目錄
xcopy /E Fin_WMAI D:\WebApp\Fin_WMAI

# 或使用 Git
git clone <repository-url> D:\WebApp\Fin_WMAI
```

---

## 3. 服務啟動與停止

### 3.1 啟動 Web 服務

```powershell
# 進入專案目錄
cd D:\Jimmy\Fin_WMAI\prototype

# 啟動 HTTP 伺服器（前景執行）
python -m http.server 8000

# 背景執行（PowerShell）
Start-Process python -ArgumentList "-m http.server 8000" -WindowStyle Hidden
```

### 3.2 啟動 AI 服務

```powershell
# 啟動 Ollama 服務
ollama serve

# 或直接運行模型（會自動啟動服務）
ollama run llama3.1:8b
```

### 3.3 驗證服務狀態

```powershell
# 檢查 Web 服務
Invoke-WebRequest -Uri "http://localhost:8000" -UseBasicParsing

# 檢查 AI 服務
Invoke-RestMethod -Uri "http://localhost:11434/api/tags" -Method Get
```

### 3.4 停止服務

```powershell
# 停止 Python HTTP 服務
# 找到程序並終止
Get-Process python | Stop-Process

# 停止 Ollama
Get-Process ollama | Stop-Process
```

### 3.5 快速啟動腳本

建立 `start-services.ps1`：

```powershell
# start-services.ps1
Write-Host "🚀 啟動 Fin_WMAI 服務..." -ForegroundColor Cyan

# 啟動 Ollama（背景）
Start-Process ollama -ArgumentList "serve" -WindowStyle Hidden
Write-Host "✅ Ollama AI 服務已啟動" -ForegroundColor Green

# 等待 Ollama 就緒
Start-Sleep -Seconds 3

# 啟動 Web 服務
Push-Location "D:\Jimmy\Fin_WMAI\prototype"
Write-Host "✅ Web 服務啟動於 http://localhost:8000" -ForegroundColor Green
python -m http.server 8000
```

---

## 4. 後台管理系統

### 4.1 存取後台

```
URL: http://localhost:8000/admin/login.html
```

### 4.2 管理員帳號

| 帳號 | 權限 | 說明 |
|------|------|------|
| admin | 超級管理員 | 完整系統權限 |
| manager | 內容管理 | 知識庫與內容管理 |
| auditor | 稽核人員 | 唯讀權限 |

### 4.3 功能模組

#### 4.3.1 系統儀表板

監控系統整體狀態：
- 活躍用戶數
- API 呼叫次數
- 系統資源使用率
- 即時告警

#### 4.3.2 知識庫管理

管理 AI 回答的知識來源：
- 新增/編輯/刪除知識條目
- 設定知識分類
- 管理引用來源
- 審核知識內容

#### 4.3.3 FAQ 管理

管理常見問題：
- 問答對維護
- 優先順序設定
- 點擊率統計

#### 4.3.4 提示詞管理

管理 AI 系統提示詞：
- System Prompt 設定
- 情境提示詞
- 白話化模板

#### 4.3.5 資料源管理

整合外部資料來源：
- 客戶資料同步
- 市場資訊更新
- 產品資料維護

#### 4.3.6 風控合規

風險與合規監控：
- 異常交易監控
- 合規審核佇列
- 稽核日誌查詢

#### 4.3.7 使用者管理

系統使用者管理：
- 帳號管理
- 角色權限配置
- 登入記錄

---

## 5. AI 服務管理

### 5.1 Ollama 服務配置

#### 檢查可用模型

```bash
ollama list
```

#### 下載新模型

```bash
# 主要模型
ollama pull llama3.1:8b

# 備用模型
ollama pull mistral-nemo:12b
ollama pull gemma3:4b
```

#### 刪除模型

```bash
ollama rm <model-name>
```

### 5.2 模型切換

修改 `js/chatbot.js` 中的設定：

```javascript
const OllamaConfig = {
    baseUrl: 'http://localhost:11434',
    model: 'llama3.1:8b',  // 修改此處切換模型
    enabled: true,
    timeout: 60000
};
```

### 5.3 AI 服務監控

```powershell
# 檢查服務狀態
Invoke-RestMethod -Uri "http://localhost:11434/api/tags" | ConvertTo-Json

# 檢查模型資訊
Invoke-RestMethod -Uri "http://localhost:11434/api/show" -Method Post -Body '{"name":"llama3.1:8b"}' -ContentType "application/json"
```

### 5.4 效能調優

| 參數 | 說明 | 建議值 |
|------|------|--------|
| timeout | API 超時時間 | 60000ms |
| num_ctx | 上下文長度 | 4096 |
| temperature | 創造性程度 | 0.7 |

---

## 6. 日常維護任務

### 6.1 每日任務

| 時間 | 任務 | 說明 |
|------|------|------|
| 09:00 | 檢查服務狀態 | 確認所有服務正常運行 |
| 09:00 | 查看錯誤日誌 | 瀏覽器開發者工具檢查 |
| 18:00 | 備份資料 | 備份 demo-data.json |

### 6.2 每週任務

| 任務 | 說明 |
|------|------|
| 清理快取 | 清除瀏覽器快取進行測試 |
| 檢查更新 | 檢查 Ollama 更新 |
| 效能分析 | 分析系統效能指標 |

### 6.3 每月任務

| 任務 | 說明 |
|------|------|
| 安全掃描 | 檢查程式碼安全性 |
| 日誌清理 | 清理過期日誌 |
| 模型評估 | 評估 AI 回答品質 |

---

## 7. 監控與告警

### 7.1 健康檢查腳本

建立 `health-check.ps1`：

```powershell
# health-check.ps1
$webOk = $false
$aiOk = $false

# 檢查 Web 服務
try {
    $response = Invoke-WebRequest -Uri "http://localhost:8000" -UseBasicParsing -TimeoutSec 5
    if ($response.StatusCode -eq 200) {
        $webOk = $true
        Write-Host "✅ Web 服務: 正常" -ForegroundColor Green
    }
} catch {
    Write-Host "❌ Web 服務: 異常" -ForegroundColor Red
}

# 檢查 AI 服務
try {
    $response = Invoke-RestMethod -Uri "http://localhost:11434/api/tags" -TimeoutSec 5
    $aiOk = $true
    Write-Host "✅ AI 服務: 正常" -ForegroundColor Green
} catch {
    Write-Host "⚠️ AI 服務: 未啟動或異常" -ForegroundColor Yellow
}

# 總結
if ($webOk -and $aiOk) {
    Write-Host "`n🎉 所有服務正常運行" -ForegroundColor Cyan
} elseif ($webOk) {
    Write-Host "`n⚠️ 部分服務異常，AI 功能可能受影響" -ForegroundColor Yellow
} else {
    Write-Host "`n❌ 關鍵服務異常，請立即處理" -ForegroundColor Red
}
```

### 7.2 效能監控指標

| 指標 | 正常範圍 | 告警閾值 |
|------|---------|---------|
| 回應時間 | < 500ms | > 2000ms |
| AI 回應時間 | < 10s | > 30s |
| 記憶體使用 | < 70% | > 90% |
| CPU 使用 | < 60% | > 85% |

---

## 8. 備份與還原

### 8.1 備份項目

| 項目 | 路徑 | 頻率 |
|------|------|------|
| Demo 資料 | `data/demo-data.json` | 每日 |
| 樣式設定 | `css/*.css` | 每週 |
| 程式碼 | `js/*.js` | 每週 |
| 設定檔 | `*.html` | 每週 |

### 8.2 備份腳本

```powershell
# backup.ps1
$date = Get-Date -Format "yyyyMMdd"
$backupDir = "D:\Backup\Fin_WMAI\$date"

# 建立備份目錄
New-Item -ItemType Directory -Path $backupDir -Force

# 複製資料
Copy-Item -Path "D:\Jimmy\Fin_WMAI\prototype\data\*" -Destination "$backupDir\data\" -Recurse
Copy-Item -Path "D:\Jimmy\Fin_WMAI\prototype\css\*" -Destination "$backupDir\css\" -Recurse
Copy-Item -Path "D:\Jimmy\Fin_WMAI\prototype\js\*" -Destination "$backupDir\js\" -Recurse

Write-Host "✅ 備份完成: $backupDir" -ForegroundColor Green
```

### 8.3 還原步驟

```powershell
# 停止服務
Get-Process python | Stop-Process -ErrorAction SilentlyContinue

# 還原資料
$backupDate = "20260131"  # 指定備份日期
Copy-Item -Path "D:\Backup\Fin_WMAI\$backupDate\*" -Destination "D:\Jimmy\Fin_WMAI\prototype\" -Recurse -Force

# 重啟服務
Push-Location "D:\Jimmy\Fin_WMAI\prototype"
python -m http.server 8000
```

---

## 9. 故障排除

### 9.1 Web 服務無法啟動

**症狀**：Port 8000 被佔用

```powershell
# 查找佔用 Port 的程序
netstat -ano | findstr :8000

# 終止程序（PID 為上一步找到的數字）
taskkill /PID <PID> /F

# 或使用其他 Port
python -m http.server 8080
```

### 9.2 AI 服務無回應

**症狀**：聊天機器人無法回答

```powershell
# 1. 檢查 Ollama 服務
ollama list

# 2. 重啟 Ollama
Get-Process ollama | Stop-Process
ollama serve

# 3. 測試 API
Invoke-RestMethod -Uri "http://localhost:11434/api/generate" -Method Post -Body '{"model":"llama3.1:8b","prompt":"Hello"}' -ContentType "application/json"
```

### 9.3 頁面樣式錯誤

**症狀**：頁面顯示異常

1. 清除瀏覽器快取（Ctrl+Shift+R）
2. 檢查 CSS 檔案是否完整
3. 查看瀏覽器開發者工具的錯誤訊息

### 9.4 登入失敗

**症狀**：無法登入系統

1. 確認使用正確的帳號
2. 清除 sessionStorage
3. 檢查 JavaScript 控制台錯誤

```javascript
// 瀏覽器開發者工具執行
sessionStorage.clear();
location.reload();
```

### 9.5 常見錯誤代碼

| 錯誤 | 說明 | 解決方案 |
|------|------|---------|
| ERR_CONNECTION_REFUSED | 服務未啟動 | 啟動 HTTP 伺服器 |
| 404 Not Found | 檔案不存在 | 檢查檔案路徑 |
| CORS Error | 跨域請求錯誤 | 使用 HTTP 伺服器而非直接開啟檔案 |
| Ollama Timeout | AI 回應超時 | 增加 timeout 設定或重啟服務 |

---

## 10. 安全管理

### 10.1 存取控制

| 層級 | 措施 |
|------|------|
| 網路 | 限制存取 IP |
| 應用 | 帳號密碼驗證 |
| 資料 | 敏感資料遮罩 |

### 10.2 安全建議

1. **定期更新**：保持 Python 和 Ollama 為最新版本
2. **強密碼**：使用複雜的管理員密碼
3. **存取記錄**：定期檢視登入記錄
4. **備份加密**：敏感資料備份需加密
5. **最小權限**：依角色給予最小必要權限

### 10.3 安全檢查清單

- [ ] 預設密碼已變更
- [ ] 不必要的服務已關閉
- [ ] 備份正常執行
- [ ] 日誌正常記錄
- [ ] 存取權限設定正確

---

## 📞 支援聯繫

如遇到無法解決的問題，請聯繫：

- **技術支援**：support@finwmai.example.com
- **緊急事件**：02-XXXX-XXXX

---

<div align="center">
  <p>Fin_WMAI 系統維護手冊 v1.0</p>
  <p>© 2026 Fin_WMAI Team</p>
</div>
